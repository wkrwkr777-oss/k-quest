# 🚀 K-Quest 배포 전 완벽 준비 체크리스트

## ✅ 완료된 수정사항 (2025-11-27)

### 1. 🔧 빌드 에러 수정
- ✅ **CSS 파싱 에러 해결**: `@import` 규칙을 파일 최상단으로 이동
- ✅ **Viewport 경고 해결**: metadata에서 viewport를 별도 export로 분리
- ✅ **Next.js 16 호환성**: middleware → proxy로 변경
- ✅ **Next.config 정리**: 더 이상 지원하지 않는 eslint 설정 제거
- ✅ **빌드 성공**: 모든 에러와 경고 해결 완료

### 2. 📁 파일 구조 최적화
```
k-quest/
├── src/
│   ├── proxy.ts (middleware.ts에서 변경)
│   ├── app/
│   │   ├── layout.tsx (viewport 분리)
│   │   └── globals.css (@import 위치 수정)
│   └── ...
├── next.config.ts (eslint 설정 제거)
└── ...
```

---

## 📋 배포 전 필수 확인사항

### 1. ⚙️ 환경 변수 설정

#### 로컬 환경 (.env.local)
```bash
# Vercel에 배포하기 전에 로컬에서 테스트용으로만 사용
# .env.local 파일은 절대 Git에 커밋하지 마세요!
```

#### Vercel 환경 변수 (필수!)
Vercel 대시보드에서 다음 환경 변수를 반드시 설정해야 합니다:

**🔐 필수 환경 변수:**
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase 프로젝트 URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase 익명 키
- `NEXT_PUBLIC_PAYPAL_CLIENT_ID` - PayPal 클라이언트 ID
- `PAYPAL_CLIENT_SECRET` - PayPal 시크릿 키 (서버용)
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` - Stripe 퍼블릭 키
- `STRIPE_SECRET_KEY` - Stripe 시크릿 키 (서버용)
- `NEXT_PUBLIC_DOMAIN` - `https://quest-k.com`

**📝 사업자 정보 (선택사항):**
- `NEXT_PUBLIC_BUSINESS_NAME` - 포텐타로
- `NEXT_PUBLIC_BUSINESS_OWNER` - 정연주
- `NEXT_PUBLIC_BUSINESS_REGISTRATION_NUMBER` - 624-17-02651
- `NEXT_PUBLIC_ECOMMERCE_PERMIT_NUMBER` - 제2025-의정부송산-0387호
- `NEXT_PUBLIC_BUSINESS_EMAIL` - wkrwkr777@gmail.com

**설정 방법:**
1. Vercel 대시보드 접속: https://vercel.com/dashboard
2. k-quest 프로젝트 선택
3. Settings → Environment Variables
4. 각 변수를 Production, Preview, Development 환경에 추가

---

### 2. 🔒 보안 설정 확인

#### proxy.ts (비공개 모드)
현재 상태: **MAINTENANCE_MODE = true** (비공개)

```typescript
const SITE_PASSWORD = 'kquest2024secret';
const MAINTENANCE_MODE = true; // true = 비공개
```

**배포 시나리오:**

**시나리오 A: 비공개 모드로 배포 (추천)**
- 현재 설정 유지: `MAINTENANCE_MODE = true`
- 사이트 접속 시 비밀번호 입력 필요
- 테스트 완료 후 공개로 전환

**시나리오 B: 공개 모드로 배포**
```typescript
const MAINTENANCE_MODE = false; // false = 공개
```
- 누구나 접속 가능
- 모든 기능 테스트 완료 후에만 권장

---

### 3. 🗄️ Supabase 데이터베이스 설정

#### 필수 SQL 실행 순서:
1. **supabase_step1_cleanup.sql** - 기존 데이터 정리
2. **supabase_setup.sql** - 기본 테이블 생성
3. **supabase_security_addon.sql** - 보안 정책 설정
4. **supabase_nationality_update.sql** - 국적 데이터 추가

**실행 방법:**
1. Supabase 대시보드: https://supabase.com/dashboard
2. 프로젝트 선택 → SQL Editor
3. 위 파일들을 순서대로 복사 → 붙여넣기 → Run

---

### 4. 💳 결제 시스템 설정

#### PayPal 설정
1. https://developer.paypal.com 접속
2. 앱 생성 및 클라이언트 ID, 시크릿 키 획득
3. Webhook 설정 (선택사항)

#### Stripe 설정
1. https://dashboard.stripe.com 접속
2. API 키 생성 (Publishable key, Secret key)
3. Webhook 엔드포인트 설정 (선택사항):
   - URL: `https://quest-k.com/api/webhooks/stripe`

---

### 5. 🌐 도메인 설정

#### Vercel 도메인 연결
1. Vercel 대시보드 → 프로젝트 설정
2. Domains → Add Domain
3. `quest-k.com` 추가
4. DNS 레코드 설정:
   - A 레코드: `76.76.21.21`
   - CNAME 레코드: `cname.vercel-dns.com`

---

### 6. 🔍 SEO 및 검색 엔진 설정

#### robots.txt 상태
현재: **완전 비공개** (모든 검색 엔진 차단)
```typescript
robots: {
  index: false,
  follow: false,
  nocache: true,
}
```

**공개 시 변경 필요:**
`src/app/layout.tsx` 파일 수정:
```typescript
robots: {
  index: true,  // 검색 허용
  follow: true, // 링크 추적 허용
}
```

---

### 7. 📱 PWA (Progressive Web App) 설정

- ✅ manifest.json 생성됨
- ✅ 서비스 워커 설정됨
- ✅ 오프라인 페이지 준비됨
- ✅ 아이콘 세트 준비됨

**확인:**
- `public/manifest.json` 존재
- `public/icons/*` 아이콘 파일 존재
- 오프라인 페이지: `/offline`

---

### 8. 🧪 로컬 테스트

#### 개발 서버 실행
```bash
npm run dev
```
또는 배치 파일 실행:
```bash
로컬_실행.bat
```

#### 프로덕션 빌드 테스트
```bash
npm run build
npm start
```

**테스트 항목:**
- [ ] 홈페이지 로딩
- [ ] 로그인/회원가입
- [ ] Quest 생성/조회
- [ ] 결제 시스템 (테스트 모드)
- [ ] 관리자 페이지 접근
- [ ] 모바일 반응형
- [ ] 오프라인 모드

---

### 9. 🚀 배포 실행

#### 방법 1: 자동 배포 (추천)
```bash
자동배포.bat
```
또는
```bash
Vercel_로그인_배포.bat
```

#### 방법 2: 수동 배포
```bash
git add .
git commit -m "배포 준비 완료 - 모든 에러 수정"
git push origin main
```

Vercel이 자동으로 배포를 시작합니다.

---

### 10. ✅ 배포 후 확인사항

#### 즉시 확인:
- [ ] https://quest-k.com 접속 가능
- [ ] 비밀번호 페이지 작동 (비공개 모드인 경우)
- [ ] 빌드 로그 확인 (Vercel 대시보드)
- [ ] 브라우저 콘솔 에러 확인 (F12)

#### 기능 테스트:
- [ ] 로그인/회원가입
- [ ] Quest 생성
- [ ] 결제 테스트
- [ ] 이미지 업로드
- [ ] PWA 설치 (모바일)
- [ ] 오프라인 모드

---

## 🚨 알려진 이슈 및 해결 방법

### CSS @tailwind 경고
```
Unknown at rule @tailwind
```
**상태:** 무시해도 됨  
**이유:** VS Code CSS 린터가 Tailwind 문법을 인식하지 못함  
**해결:** PostCSS가 빌드 시 정상 처리함

### Multiple lockfiles 경고
```
Warning: Next.js inferred your workspace root
```
**상태:** 무시해도 됨  
**이유:** 상위 폴더에 package-lock.json이 있음  
**해결 (선택):** next.config.ts에 `turbopack.root` 설정

---

## 📞 긴급 문제 발생 시

### 빌드 실패 시:
1. `.next` 폴더 삭제
2. `node_modules` 삭제
3. `npm install` 재실행
4. `npm run build` 재시도

```bash
Remove-Item -Recurse -Force .next
Remove-Item -Recurse -Force node_modules
npm install
npm run build
```

### 환경 변수 오류 시:
1. Vercel 대시보드에서 환경 변수 다시 확인
2. Redeploy 클릭
3. 로컬에서 `.env.local` 파일 확인

### 데이터베이스 연결 오류 시:
1. Supabase URL과 Key 확인
2. Supabase 프로젝트 활성화 상태 확인
3. SQL 파일 재실행

---

## 🎉 배포 완료 체크리스트

배포가 완료되면 다음을 확인하세요:

- [ ] ✅ 빌드 성공 (에러 0개)
- [ ] ✅ 환경 변수 모두 설정
- [ ] ✅ Supabase 연결 확인
- [ ] ✅ 도메인 접속 가능
- [ ] ✅ 비공개 모드 작동 (해당 시)
- [ ] ✅ 로그인 기능 작동
- [ ] ✅ 결제 시스템 테스트 완료
- [ ] ✅ 모바일 반응형 확인
- [ ] ✅ PWA 설치 가능

---

## 📚 참고 문서

- [Next.js 16 문서](https://nextjs.org/docs)
- [Vercel 배포 가이드](https://vercel.com/docs)
- [Supabase 문서](https://supabase.com/docs)
- [PayPal 개발자 문서](https://developer.paypal.com)
- [Stripe 문서](https://stripe.com/docs)

---

**마지막 업데이트:** 2025-11-27 20:50 KST  
**상태:** 🟢 배포 준비 완료 - 모든 에러 해결됨!
